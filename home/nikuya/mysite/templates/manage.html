<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>座席管理</title>
    <link rel="stylesheet" href="/static/style.css">
    <style>
        body { font-family: 'Segoe UI', 'Meiryo', sans-serif; background: #f8f8f8; margin: 0; }
        .container { max-width: 480px; margin: 24px auto; background: #fff; border-radius: 12px; box-shadow: 0 2px 8px #0001; padding: 20px; }
        h1 { font-size: 1.3em; margin-bottom: 16px; text-align: center; }
        .seat-list { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 16px; }
        .seat-item { background: #eee; border-radius: 6px; padding: 8px 12px; font-size: 1em; display: flex; align-items: center; }
        .seat-item.selected { background: #cce5ff; }
        .seat-actions { display: flex; gap: 8px; margin-bottom: 16px; justify-content: center; }
        button, select, input[type=number] { font-size: 1em; border-radius: 6px; border: 1px solid #ccc; padding: 6px 12px; background: #fff; }
        button { background: #007bff; color: #fff; border: none; cursor: pointer; transition: background 0.2s; }
        button:hover { background: #0056b3; }
        .add-form { display: flex; gap: 8px; margin-bottom: 16px; justify-content: center; }
        @media (max-width: 600px) {
            .container { max-width: 98vw; padding: 8vw 2vw; }
            .seat-list { gap: 4px; }
            .add-form, .seat-actions { flex-direction: column; gap: 6px; }
        }
    </style>
</head>
<body>
<div class="container">
    <h1>座席管理</h1>
    <div class="seat-actions">
        <select id="sortOrder">
            <option value="asc">小さい順</option>
            <option value="desc">大きい順</option>
        </select>
        <button onclick="reloadSeats()">並び替え</button>
    </div>
</div>
    <div class="seat-list" id="seatList"></div>
    <form class="add-form" onsubmit="addSeat(event)">
        <input type="number" id="newSeat" placeholder="座席番号" min="1" required>
        <button type="submit">追加</button>
    </form>
    <div id="actionBtns" style="position:fixed;right:16px;bottom:16px;z-index:10;display:none;flex-direction:column;gap:8px;">
        <button id="editBtn" style="background:#28a745;">編集</button>
        <button id="deleteBtn" style="background:#dc3545;">削除</button>
    </div>
</div>
</div>
<script>
let selectedSeat = null;
function reloadSeats() {
    const order = document.getElementById('sortOrder').value;
    fetch(`/api/seats?order=${order}`)
        .then(res => res.json())
        .then(seats => {
            const seatList = document.getElementById('seatList');
            seatList.innerHTML = '';
            seats.forEach(seat => {
                const div = document.createElement('div');
                div.className = 'seat-item';
                div.textContent = seat;
                div.onclick = () => selectSeat(div, seat);
                if (selectedSeat === seat) div.classList.add('selected');
                seatList.appendChild(div);
            });
            updateActionBtns();
        });
}
function selectSeat(div, seat) {
    selectedSeat = seat;
    document.querySelectorAll('.seat-item').forEach(d => d.classList.remove('selected'));
    div.classList.add('selected');
    updateActionBtns();
}
function updateActionBtns() {
    const btns = document.getElementById('actionBtns');
    if (selectedSeat !== null) {
        btns.style.display = 'flex';
    } else {
        btns.style.display = 'none';
    }
}
function addSeat(e) {
    e.preventDefault();
    const seat = document.getElementById('newSeat').value;
    fetch('/api/seats', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ seat: Number(seat) })
    })
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            document.getElementById('newSeat').value = '';
            selectedSeat = null;
            reloadSeats();
        } else {
            alert(data.error || '追加失敗');
        }
    });
}
document.getElementById('editBtn').onclick = function() {
    if (selectedSeat === null) return;
    const newSeat = prompt(`座席 ${selectedSeat} を編集します。新しい番号を入力してください:`, selectedSeat);
    if (newSeat && !isNaN(newSeat)) {
        fetch(`/api/seats/${selectedSeat}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ seat: Number(newSeat) })
        })
        .then(res => res.json())
        .then(data => {
            if (data.success) {
                selectedSeat = null;
                reloadSeats();
            } else {
                alert(data.error || '編集失敗');
            }
        });
    }
};
document.getElementById('deleteBtn').onclick = function() {
    if (selectedSeat === null) return;
    if (!confirm(`座席 ${selectedSeat} を削除しますか？`)) return;
    fetch(`/api/seats/${selectedSeat}`, { method: 'DELETE' })
        .then(res => res.json())
        .then(data => {
            if (data.success) {
                selectedSeat = null;
                reloadSeats();
            } else {
                alert(data.error || '削除失敗');
            }
        });
};
document.getElementById('sortOrder').addEventListener('change', reloadSeats);
window.onload = reloadSeats;
</script>
</body>
</html>
    <div>
        <span class="tab active" data-tab="seats">座席</span>
        <span class="tab" data-tab="courses">コース</span>
        <span class="tab" data-tab="dishes">商品</span>
    </div>
    <div id="seats-section" class="section active">
        <h2>座席管理</h2>
        <div id="seats-list" class="item-list"></div>
        <button onclick="showSeatForm()">座席追加</button>
        <div id="seat-form" style="display:none;"></div>
    </div>
    <div id="courses-section" class="section">
        <h2>コース管理</h2>
        <div id="courses-list" class="item-list"></div>
        <button onclick="showCourseForm()">コース追加</button>
        <div id="course-form" style="display:none;"></div>
    </div>
    <div id="dishes-section" class="section">
        <h2>商品管理</h2>
        <div id="dishes-list" class="item-list"></div>
        <button onclick="showDishForm()">商品追加</button>
        <div id="dish-form" style="display:none;"></div>
    </div>
    <script>
        // タブ切り替え
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function() {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
                document.getElementById(this.dataset.tab + '-section').classList.add('active');
            });
        });

        // ===== 座席管理 =====
        async function loadSeats() {
            const res = await fetch('/api/seats');
            const seats = await res.json();
            const list = document.getElementById('seats-list');
            list.innerHTML = '';
            seats.forEach(seat => {
                const div = document.createElement('div');
                div.className = 'item';
                div.innerHTML = `座席番号: <b>${seat}</b> <span class="actions">
                    <button onclick="editSeat(${seat})">編集</button>
                    <button onclick="deleteSeat(${seat})">削除</button>
                </span>`;
                list.appendChild(div);
            });
        }
        async function showSeatForm() {
            const form = document.getElementById('seat-form');
            form.style.display = 'block';
            form.innerHTML = `<input type='number' id='new-seat' placeholder='座席番号'>
                <button onclick='addSeat()'>追加</button>`;
        }
        async function addSeat() {
            const seat = document.getElementById('new-seat').value;
            await fetch('/api/seats', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({seat: Number(seat)})
            });
            document.getElementById('seat-form').style.display = 'none';
            loadSeats();
        }
        async function editSeat(seat) {
            const form = document.getElementById('seat-form');
            form.style.display = 'block';
            form.innerHTML = `<input type='number' id='edit-seat' value='${seat}'>
                <button onclick='updateSeat(${seat})'>更新</button>`;
        }
        async function updateSeat(oldSeat) {
            const newSeat = document.getElementById('edit-seat').value;
            await fetch(`/api/seats/${oldSeat}`, {
                method: 'PUT',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({seat: Number(newSeat)})
            });
            document.getElementById('seat-form').style.display = 'none';
            loadSeats();
        }
        async function deleteSeat(seat) {
            if (!confirm('削除しますか？')) return;
            await fetch(`/api/seats/${seat}`, {method: 'DELETE'});
            loadSeats();
        }

        // ===== コース管理 =====
        async function loadCourses() {
            const res = await fetch('/api/courses');
            const courses = await res.json();
            const list = document.getElementById('courses-list');
            list.innerHTML = '';
            courses.forEach(course => {
                const div = document.createElement('div');
                div.className = 'item';
                div.innerHTML = `ID: <b>${course.id}</b> 名称: <b>${course.name}</b> 
                    <span class='actions'>
                        <button onclick="editCourse('${course.id}', '${course.name}', ${course.hidden})">編集</button>
                        <button onclick="deleteCourse('${course.id}')">削除</button>
                        <button onclick="toggleCourseHidden('${course.id}', ${!course.hidden})">${course.hidden ? '表示' : '非表示'}</button>
                    </span>`;
                list.appendChild(div);
            });
        }
        async function showCourseForm() {
            const form = document.getElementById('course-form');
            form.style.display = 'block';
            form.innerHTML = `<input type='text' id='new-course-id' placeholder='コースID'>
                <input type='text' id='new-course-name' placeholder='コース名'>
                <button onclick='addCourse()'>追加</button>`;
        }
        async function addCourse() {
            const id = document.getElementById('new-course-id').value;
            const name = document.getElementById('new-course-name').value;
            await fetch('/api/courses', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({id, name})
            });
            document.getElementById('course-form').style.display = 'none';
            loadCourses();
        }
        async function editCourse(id, name, hidden) {
            const form = document.getElementById('course-form');
            form.style.display = 'block';
            form.innerHTML = `<input type='text' id='edit-course-name' value='${name}'>
                <button onclick="updateCourse('${id}')">更新</button>`;
        }
        async function updateCourse(id) {
            const name = document.getElementById('edit-course-name').value;
            await fetch(`/api/courses/${id}`, {
                method: 'PUT',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({name})
            });
            document.getElementById('course-form').style.display = 'none';
            loadCourses();
        }
        async function deleteCourse(id) {
            if (!confirm('削除しますか？')) return;
            await fetch(`/api/courses/${id}`, {method: 'DELETE'});
            loadCourses();
        }
        async function toggleCourseHidden(id, hidden) {
            await fetch(`/api/courses/${id}`, {
                method: 'PUT',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({hidden})
            });
            loadCourses();
        }

        // ===== 商品管理 =====
        let selectedCourseId = '';
        async function loadDishes(courseId) {
            selectedCourseId = courseId;
            const res = await fetch(`/api/dishes/${courseId}`);
            const dishes = await res.json();
            const list = document.getElementById('dishes-list');
            list.innerHTML = `<b>コースID: ${courseId}</b><br>`;
            dishes.forEach(dish => {
                const div = document.createElement('div');
                div.className = 'item';
                div.innerHTML = `カテゴリ: <b>${dish.category}</b> 名称: <b>${dish.name}</b> 
                    <span class='actions'>
                        <button onclick="editDish('${dish.id}', '${dish.name}', '${dish.category}', ${dish.hidden})">編集</button>
                        <button onclick="deleteDish('${dish.id}')">削除</button>
                        <button onclick="toggleDishHidden('${dish.id}', ${!dish.hidden})">${dish.hidden ? '表示' : '非表示'}</button>
                    </span>`;
                list.appendChild(div);
            });
        }
        async function showDishForm() {
            const form = document.getElementById('dish-form');
            form.style.display = 'block';
            form.innerHTML = `<input type='text' id='dish-category' placeholder='カテゴリ'>
                <input type='text' id='dish-id' placeholder='商品ID'>
                <input type='text' id='dish-name' placeholder='商品名'>
                <button onclick='addDish()'>追加</button>`;
        }
        async function addDish() {
            const category = document.getElementById('dish-category').value;
            const id = document.getElementById('dish-id').value;
            const name = document.getElementById('dish-name').value;
            await fetch(`/api/dishes/${selectedCourseId}`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({category, id, name})
            });
            document.getElementById('dish-form').style.display = 'none';
            loadDishes(selectedCourseId);
        }
        async function editDish(id, name, category, hidden) {
            const form = document.getElementById('dish-form');
            form.style.display = 'block';
            form.innerHTML = `<input type='text' id='edit-dish-name' value='${name}'>
                <button onclick="updateDish('${id}')">更新</button>`;
        }
        async function updateDish(id) {
            const name = document.getElementById('edit-dish-name').value;
            await fetch(`/api/dishes/${selectedCourseId}/${id}`, {
                method: 'PUT',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({name})
            });
            document.getElementById('dish-form').style.display = 'none';
            loadDishes(selectedCourseId);
        }
        async function deleteDish(id) {
            if (!confirm('削除しますか？')) return;
            await fetch(`/api/dishes/${selectedCourseId}/${id}`, {method: 'DELETE'});
            loadDishes(selectedCourseId);
        }
        async function toggleDishHidden(id, hidden) {
            await fetch(`/api/dishes/${selectedCourseId}/${id}`, {
                method: 'PUT',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({hidden})
            });
            loadDishes(selectedCourseId);
        }

        // ===== 初期表示 =====
        document.addEventListener('DOMContentLoaded', async function() {
            await loadSeats();
            await loadCourses();
            // 商品管理はコース選択UIを追加
            const dishList = document.getElementById('dishes-list');
            const res = await fetch('/api/courses');
            const courses = await res.json();
            let selectHtml = '<select id="course-select">';
            courses.forEach(c => {
                selectHtml += `<option value='${c.id}'>${c.name}</option>`;
            });
            selectHtml += '</select> <button onclick="selectCourseForDishes()">表示</button>';
            dishList.innerHTML = selectHtml;
        });
        window.selectCourseForDishes = function() {
            const courseId = document.getElementById('course-select').value;
            loadDishes(courseId);
        }
    </script>
</body>
</html>
