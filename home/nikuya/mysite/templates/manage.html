<nav class="main-nav">
    <a href="/" class="main-nav-link nav-seat">席選択</a>
    <a href="/staff" class="main-nav-link nav-staff">スタッフ</a>
    <a href="/settings" class="main-nav-link nav-settings">設定</a>
</nav>
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>座席管理</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
<div class="container">
  <div id="manage-tabs">
    <button class="manage-tab active" data-target="seatSection">座席管理</button>
    <button class="manage-tab" data-target="courseSection">コース管理</button>
    <button class="manage-tab" data-target="dishSection">商品管理</button>
        <button class="manage-tab" data-target="settingsSection">設定</button>
</div>
<section id="seatSection">
  <div class="container">
    <h1>座席管理</h1>
    <div class="seat-actions">
        <select id="sortOrder">
            <option value="asc">小さい順</option>
            <option value="desc">大きい順</option>
        </select>
    </div>
    <div class="seat-list" id="seatList"></div>
    <form class="add-form" onsubmit="addSeat(event)">
        <input type="number" id="newSeat" placeholder="座席番号" min="1" required>
        <button type="submit">追加</button>
    </form>
    <div id="actionBtns">
        <button id="editBtn" style="background:#28a745;">編集</button>
        <button id="deleteBtn" style="background:#dc3545;">削除</button>
    </div>
  </div>
</section>
<script>
let selectedSeat = null;
function reloadSeats() {
    const order = document.getElementById('sortOrder').value;
    fetch(`/api/seats?order=${order}`)
        .then(res => res.json())
        .then(seats => {
            const seatList = document.getElementById('seatList');
            seatList.innerHTML = '';
            seats.forEach(seat => {
    <a href="/" class="main-nav-link nav-seat">Seat Selection</a>
    <a href="/staff" class="main-nav-link nav-staff">Staff</a>
    <a href="/settings" class="main-nav-link nav-settings">Settings</a>
                const div = document.createElement('div');
                div.className = 'seat-item';
    <title>Seat Management</title>
                div.textContent = seat;
                div.onclick = () => selectSeat(div, seat);
                if (selectedSeat === seat) div.classList.add('selected');
                seatList.appendChild(div);
            });
    <button class="manage-tab active" data-target="seatSection">Seat Management</button>
    <button class="manage-tab" data-target="courseSection">Course Management</button>
    <button class="manage-tab" data-target="dishSection">Dish Management</button>
    <button class="manage-tab" data-target="settingsSection">Settings</button>
            updateActionBtns();
    <h1>Seat Management</h1>
        });
}
function selectSeat(div, seat) {
    selectedSeat = seat;
        <select id="sortOrder">
            <option value="asc">Ascending</option>
            <option value="desc">Descending</option>
        </select>
    document.querySelectorAll('.seat-item').forEach(d => d.classList.remove('selected'));
    div.classList.add('selected');
        <input type="number" id="newSeat" placeholder="Seat Number" min="1" required>
        <button type="submit">Add</button>
    updateActionBtns();
}
        <button id="editBtn" style="background:#28a745;">Edit</button>
        <button id="deleteBtn" style="background:#dc3545;">Delete</button>
function updateActionBtns() {
    const newSeat = prompt(`Edit seat ${selectedSeat}. Enter a new number:`, selectedSeat);
    const btns = document.getElementById('actionBtns');
    if (!confirm(`Delete seat ${selectedSeat}?`)) return;
    if (selectedSeat !== null) {
            alert(data.error || 'Failed to add');
        btns.style.display = 'flex';
                alert(data.error || 'Failed to edit');
    } else {
                alert(data.error || 'Failed to delete');
        btns.style.display = 'none';
    <h1>Course Management</h1>
    }
}
function addSeat(e) {
    e.preventDefault();
        <select id="courseSort">
            <option value="asc">Ascending</option>
            <option value="desc">Descending</option>
        </select>
    const seat = document.getElementById('newSeat').value;
    fetch('/api/seats', {
        method: 'POST',
        <input type="text" id="newCourseId" placeholder="Course ID" required style="width:40%">
        <input type="text" id="newCourseName" placeholder="Course Name" required style="width:40%">
        <button type="submit">Add</button>
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ seat: Number(seat) })
    })
        <button id="editCourseBtn" style="background:#28a745;">Edit</button>
        <button id="deleteCourseBtn" style="background:#dc3545;">Delete</button>
        <button id="toggleCourseBtn" style="background:#ffc107;color:#333;">Show/Hide</button>
    .then(res => res.json())
    const newName = prompt(`Edit course name:`, selectedCourse.name);
    .then(data => {
    if(!confirm(`Delete course ${selectedCourse.name} (${selectedCourse.id})?`)) return;
        if (data.success) {
        else alert(data.error||'Failed to delete');
            document.getElementById('newSeat').value = '';
        else alert(data.error||'Failed to edit');
            selectedSeat = null;
        else alert(data.error||'Failed to toggle');
            reloadSeats();
    <h1>Dish Management</h1>
        } else {
            alert(data.error || '追加失敗');
        }
    });
}
document.getElementById('editBtn').onclick = function() {
    if (selectedSeat === null) return;
        <select id="dishCourse">
            <option value="">Select Course</option>
        </select>
        <select id="dishSort">
            <option value="asc">Ascending</option>
            <option value="desc">Descending</option>
        </select>
    const newSeat = prompt(`座席 ${selectedSeat} を編集します。新しい番号を入力してください:`, selectedSeat);
    if (newSeat && !isNaN(newSeat)) {
        fetch(`/api/seats/${selectedSeat}`, {
            method: 'PUT',
        <input type="text" id="newDishCategory" placeholder="Category" required style="width:30%">
        <input type="text" id="newDishId" placeholder="Dish ID" required style="width:30%">
        <input type="text" id="newDishName" placeholder="Dish Name" required style="width:30%">
        <button type="submit">Add</button>
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ seat: Number(newSeat) })
        })
        <button id="editDishBtn" style="background:#28a745;">Edit</button>
        <button id="deleteDishBtn" style="background:#dc3545;">Delete</button>
        <button id="toggleDishBtn" style="background:#ffc107;color:#333;">Show/Hide</button>
        .then(res => res.json())
      sel.innerHTML = '<option value="">Select Course</option>';
        .then(data => {
                  div.textContent = `${dish.name} (${dish.id}) [${dish.category}]` + (dish.hidden ? ' [Hidden]' : '');
            if (data.success) {
      if(!currentCourse){alert('Please select a course');return;}
                selectedSeat = null;
      const newName = prompt('Edit dish name:',selectedDish.name);
                reloadSeats();
      if(!confirm(`Delete dish ${selectedDish.name} (${selectedDish.id})?`)) return;
            } else {
          else alert(data.error||'Failed to delete');
                alert(data.error || '編集失敗');
          else alert(data.error||'Failed to edit');
            }
          else alert(data.error||'Failed to toggle');
        });
    }
};
document.getElementById('deleteBtn').onclick = function() {
    if (selectedSeat === null) return;
    if (!confirm(`座席 ${selectedSeat} を削除しますか？`)) return;
    fetch(`/api/seats/${selectedSeat}`, { method: 'DELETE' })
        .then(res => res.json())
        .then(data => {
            if (data.success) {
                selectedSeat = null;
                reloadSeats();
            } else {
                alert(data.error || '削除失敗');
            }
        });
};
document.getElementById('sortOrder').addEventListener('change', reloadSeats);
window.onload = reloadSeats;
</script>

<!-- コース管理UI -->
<section id="courseSection" hidden>
  <div class="container course-container">
    <h1>コース管理</h1>
    <div class="course-actions">
        <select id="courseSort">
            <option value="asc">小さい順</option>
            <option value="desc">大きい順</option>
        </select>
    </div>
    <div class="course-list" id="courseList"></div>
    <form class="add-form" onsubmit="addCourse(event)">
        <input type="text" id="newCourseId" placeholder="コースID" required style="width:40%">
        <input type="text" id="newCourseName" placeholder="コース名" required style="width:40%">
        <button type="submit">追加</button>
    </form>
    <div id="courseActionBtns">
        <button id="editCourseBtn" style="background:#28a745;">編集</button>
        <button id="deleteCourseBtn" style="background:#dc3545;">削除</button>
        <button id="toggleCourseBtn" style="background:#ffc107;color:#333;">表示/非表示</button>
    </div>
  </div>
</section>

<script>
let selectedCourse = null;
function reloadCourses() {
    const order = document.getElementById('courseSort').value;
    fetch(`/api/courses`)
        .then(res => res.json())
        .then(courses => {
            if(order==='asc') courses.sort((a,b)=>a.id.localeCompare(b.id));
            else courses.sort((a,b)=>b.id.localeCompare(a.id));
            const courseList = document.getElementById('courseList');
            courseList.innerHTML = '';
            courses.forEach(course => {
                const div = document.createElement('div');
                div.className = 'seat-item';
                div.textContent = `${course.name} (${course.id})` + (course.hidden ? ' [非表示]' : '');
                div.onclick = () => selectCourse(div, course);
                if(selectedCourse && selectedCourse.id===course.id) div.classList.add('selected');
                courseList.appendChild(div);
            });
            updateCourseBtns();
        });
}
function selectCourse(div, course) {
    selectedCourse = course;
    document.querySelectorAll('.course-list .seat-item').forEach(d => d.classList.remove('selected'));
    div.classList.add('selected');
    updateCourseBtns();
}
function updateCourseBtns() {
    const btns = document.getElementById('courseActionBtns');
    if(selectedCourse) btns.style.display = 'flex';
    else btns.style.display = 'none';
}
function addCourse(e) {
    e.preventDefault();
    const id = document.getElementById('newCourseId').value.trim();
    const name = document.getElementById('newCourseName').value.trim();
    fetch('/api/courses', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ id, name })
    })
    .then(res => res.json())
    .then(data => {
        if(data.success){
            document.getElementById('newCourseId').value = '';
            document.getElementById('newCourseName').value = '';
            selectedCourse = null;
            reloadCourses();
        }else{
            alert(data.error||'追加失敗');
        }
    });
}
document.getElementById('editCourseBtn').onclick = function(){
    if(!selectedCourse) return;
    const newName = prompt(`コース名を編集:`, selectedCourse.name);
    if(newName){
        fetch(`/api/courses/${selectedCourse.id}`,{
            method:'PUT',
            headers:{'Content-Type':'application/json'},
            body:JSON.stringify({name:newName})
        })
        .then(res=>res.json())
        .then(data=>{
            if(data.success){selectedCourse=null;reloadCourses();}
            else alert(data.error||'編集失敗');
        });
    }
};
document.getElementById('deleteCourseBtn').onclick = function(){
    if(!selectedCourse) return;
    if(!confirm(`コース ${selectedCourse.name} (${selectedCourse.id}) を削除しますか？`)) return;
    fetch(`/api/courses/${selectedCourse.id}`,{method:'DELETE'})
        .then(res=>res.json())
        .then(data=>{
            if(data.success){selectedCourse=null;reloadCourses();}
            else alert(data.error||'削除失敗');
        });
};
document.getElementById('toggleCourseBtn').onclick = function(){
    if(!selectedCourse) return;
    fetch(`/api/courses/${selectedCourse.id}`,{
        method:'PUT',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({hidden:!selectedCourse.hidden})
    })
    .then(res=>res.json())
    .then(data=>{
        if(data.success){selectedCourse=null;reloadCourses();}
        else alert(data.error||'切替失敗');
    });
};
document.getElementById('courseSort').addEventListener('change', reloadCourses);
window.addEventListener('DOMContentLoaded', reloadCourses);
</script>

<!-- 商品管理UI -->
<section id="dishSection" hidden>
  <div class="container dish-container">
    <h1>商品管理</h1>
    <div class="dish-actions">
        <select id="dishCourse">
            <option value="">コース選択</option>
        </select>
        <select id="dishSort">
            <option value="asc">小さい順</option>
            <option value="desc">大きい順</option>
        </select>
    </div>
    <div class="dish-list" id="dishList"></div>
    <form class="add-form" onsubmit="addDish(event)">
        <input type="text" id="newDishCategory" placeholder="カテゴリ" required style="width:30%">
        <input type="text" id="newDishId" placeholder="商品ID" required style="width:30%">
        <input type="text" id="newDishName" placeholder="商品名" required style="width:30%">
        <button type="submit">追加</button>
    </form>
    <div id="dishActionBtns">
        <button id="editDishBtn" style="background:#28a745;">編集</button>
        <button id="deleteDishBtn" style="background:#dc3545;">削除</button>
        <button id="toggleDishBtn" style="background:#ffc107;color:#333;">表示/非表示</button>
    </div>
  </div>
</section>

<script>
window.addEventListener('DOMContentLoaded', () => {
  // タブ切り替え
  document.querySelectorAll('.manage-tab').forEach(btn => {
    btn.onclick = function() {
      document.querySelectorAll('.manage-tab').forEach(b => b.classList.remove('active'));
      this.classList.add('active');
      document.getElementById('seatSection').hidden = true;
      document.getElementById('courseSection').hidden = true;
      document.getElementById('dishSection').hidden = true;
      document.getElementById(this.dataset.target).hidden = false;
    };
  });
  // 初期表示: 座席管理のみ表示
  document.getElementById('seatSection').hidden = false;
  document.getElementById('courseSection').hidden = true;
  document.getElementById('dishSection').hidden = true;
  reloadSeats();
  reloadCourses();
  reloadDishCourses();

  // 商品管理JS
  let selectedDish = null;
  let currentCourse = '';
  function reloadDishCourses(){
      fetch('/api/courses')
          .then(res=>res.json())
          .then(courses=>{
              const sel = document.getElementById('dishCourse');
              sel.innerHTML = '<option value="">コース選択</option>';
              courses.forEach(c=>{
                  sel.innerHTML += `<option value="${c.id}">${c.name} (${c.id})</option>`;
              });
          });
  }
  function reloadDishes(){
      const courseId = document.getElementById('dishCourse').value;
      currentCourse = courseId;
      if(!courseId){document.getElementById('dishList').innerHTML='';return;}
      fetch(`/api/dishes/${courseId}`)
          .then(res=>res.json())
          .then(dishes=>{
              const order = document.getElementById('dishSort').value;
              if(order==='asc') dishes.sort((a,b)=>a.id.localeCompare(b.id));
              else dishes.sort((a,b)=>b.id.localeCompare(a.id));
              const dishList = document.getElementById('dishList');
              dishList.innerHTML = '';
              dishes.forEach(dish=>{
                  const div = document.createElement('div');
                  div.className = 'seat-item';
                  div.textContent = `${dish.name} (${dish.id}) [${dish.category}]` + (dish.hidden ? ' [非表示]' : '');
                  div.onclick = () => selectDish(div, dish);
                  if(selectedDish && selectedDish.id===dish.id) div.classList.add('selected');
                  dishList.appendChild(div);
              });
              updateDishBtns();
          });
  }
  function selectDish(div, dish){
      selectedDish = dish;
      document.querySelectorAll('.dish-list .seat-item').forEach(d=>d.classList.remove('selected'));
      div.classList.add('selected');
      updateDishBtns();
  }
  function updateDishBtns(){
      const btns = document.getElementById('dishActionBtns');
      if(selectedDish) btns.style.display = 'flex';
      else btns.style.display = 'none';
  }
  function addDish(e){
      e.preventDefault();
      if(!currentCourse){alert('コースを選択してください');return;}
      const category = document.getElementById('newDishCategory').value.trim();
      const id = document.getElementById('newDishId').value.trim();
      const name = document.getElementById('newDishName').value.trim();
      fetch(`/api/dishes/${currentCourse}`,{
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body:JSON.stringify({category,id,name})
      })
      .then(res=>res.json())
      .then(data=>{
          if(data.success){
              document.getElementById('newDishCategory').value='';
              document.getElementById('newDishId').value='';
              document.getElementById('newDishName').value='';
              selectedDish=null;
              reloadDishes();
          }else{
              alert(data.error||'追加失敗');
          }
      });
  }
  document.getElementById('editDishBtn').onclick = function(){
      if(!selectedDish||!currentCourse) return;
      const newName = prompt('商品名を編集:',selectedDish.name);
      if(newName){
          fetch(`/api/dishes/${currentCourse}/${selectedDish.id}`,{
              method:'PUT',
              headers:{'Content-Type':'application/json'},
              body:JSON.stringify({name:newName})
          })
          .then(res=>res.json())
          .then(data=>{
              if(data.success){selectedDish=null;reloadDishes();}
              else alert(data.error||'編集失敗');
          });
      }
  };
  document.getElementById('deleteDishBtn').onclick = function(){
      if(!selectedDish||!currentCourse) return;
      if(!confirm(`商品 ${selectedDish.name} (${selectedDish.id}) を削除しますか？`)) return;
      fetch(`/api/dishes/${currentCourse}/${selectedDish.id}`,{method:'DELETE'})
          .then(res=>res.json())
          .then(data=>{
              if(data.success){selectedDish=null;reloadDishes();}
              else alert(data.error||'削除失敗');
          });
  };
  document.getElementById('toggleDishBtn').onclick = function(){
      if(!selectedDish||!currentCourse) return;
      fetch(`/api/dishes/${currentCourse}/${selectedDish.id}`,{
          method:'PUT',
          headers:{'Content-Type':'application/json'},
          body:JSON.stringify({hidden:!selectedDish.hidden})
      })
      .then(res=>res.json())
      .then(data=>{
          if(data.success){selectedDish=null;reloadDishes();}
          else alert(data.error||'切替失敗');
      });
  };
  document.getElementById('dishCourse').addEventListener('change',reloadDishes);
  document.getElementById('dishSort').addEventListener('change',reloadDishes);
});
</script>
</body>
</html>
    <!-- 旧UI・旧JS完全削除済み。新UIのみ残しています。 -->
</body>
</html>
