<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Closed - Seat {{ seat }}</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="notice-container">
        <div class="notice-content">
            <h1>Order Time Ended</h1>
            <div class="seat-info">
                <h2>Seat {{ seat }}</h2>
            </div>
            <div class="message">
                <p class="main-message">The order time for this seat has ended.</p>
                <p class="sub-message">Please enjoy your meal.</p>
                <p class="sub-message">Prepare for checkout when you are ready.</p>
            </div>
            <div class="actions">
                <a href="{{ url_for('index') }}" class="button primary">Back to Home</a>
            </div>
            <div class="remaining-time" id="remaining-time">
                <!-- Remaining time will be displayed by JavaScript -->
            </div>
        </div>
    </div>

    <script>
        // 席の残り時間を表示
        document.addEventListener('DOMContentLoaded', async () => {
            const seatNum = {{ seat }};
            
            async function updateTimer() {
                try {
                    const response = await fetch('/timer_update');
                    const timerData = await response.json();
                    
                    if (timerData && timerData[seatNum]) {
                        const info = timerData[seatNum];
                        const remainingElement = document.getElementById('remaining-time');
                        
                        if (info.seat_remaining_minutes > 0 || info.seat_remaining_seconds > 0) {
                            remainingElement.innerHTML = `
                                <p class="timer-info">席の残り時間: ${info.seat_remaining_minutes}分 ${info.seat_remaining_seconds}秒</p>
                            `;
                        } else {
                            remainingElement.innerHTML = `
                                <p class="timer-expired">席のお時間が終了しました。お会計をお願いします。</p>
                            `;
                            // 会計案内ページにリダイレクト
                            setTimeout(() => {
                                window.location.href = '/seat/' + seatNum;
                            }, 3000);
                        }
                    }
                } catch (error) {
                    console.error('Timer update error:', error);
                }
            }
            
            // 初回更新
            updateTimer();
            // 5秒ごとに更新
            setInterval(updateTimer, 5000);
        });
    </script>
</body>
</html>
